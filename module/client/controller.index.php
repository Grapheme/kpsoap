<?class index_client extends TClientController {	public function index($code_name){		$this->content = $this->load_module($code_name);		$content = $this->core->sql->query("SELECT * FROM `dat_index` WHERE `alias`='_' ORDER BY `priority`");				$content->cell[0]['text'] = func::delEmptyParagraph(func::delShortTagText($content->cell[0]['text']));		$title = $content->cell[0]['title'];		$text = $content->cell[0]['text'];				$groups = $this->core->sql->query("SELECT * FROM `dat_catalog_type`");		$assoc = array();		if ($groups->num_rows > 0) {			for ($i=0; $i<$groups->num_rows; $i++) {				$assoc[$groups->cell[$i]['id']] = $groups->cell[$i]['alias'];			}		}				$sell = $this->core->sql->query("	SELECT 												`dat_catalog_list`.`id`,												`dat_catalog_list`.`article`,												`dat_catalog_list`.`title`,												`dat_catalog_type`.`alias` as `groupalias`,												`dat_catalog_list`.`photo`,												`dat_catalog_type`.`name`,												`dat_catalog_list`.`price`,												`dat_catalog_list`.`price_sell`,												if(UNIX_TIMESTAMP()-UNIX_TIMESTAMP(`dat_catalog_list`.`last_update`)<2592000, 1, 0) as `new`											FROM												`dat_catalog_list` LEFT JOIN `dat_catalog_type` ON (`dat_catalog_type`.`id` = `dat_catalog_list`.`type_id`)											WHERE												`dat_catalog_list`.`photo` <> ''											ORDER BY												`new` DESC,												rand()											LIMIT 												0, 24");				for ($i=0; $i<$sell->num_rows; $i++) {			if (empty($sell->cell[$i]['photo']))				$sell->cell[$i]['photo'] = 'nophoto.gif';							if (!preg_match('#^http:#', $sell->cell[$i]['photo'])) {				$sell->cell[$i]['photo'] = preg_replace('#;.*#','',$sell->cell[$i]['photo']);				$sell->cell[$i]['photo'] = "http://{$_SERVER['SERVER_NAME']}/img-dbimage/catalog/{$sell->cell[$i]['groupalias']}/".preg_replace('#\.([a-z]{3}$)#i','-$1',$sell->cell[$i]['photo'])."-181c121-85.jpg";			}			$sell->cell[$i]['psize'] = func::imageGetSizeRestric($sell->cell[$i]['photo'], 181, 121);			$sell->cell[$i]['title_eng'] = preg_replace('/(\(.+\))/i','',$sell->cell[$i]['title']);		}		$this->content['produce_sell'] = isset($sell)?$sell->cell:null;				/*$prods = $this->core->sql->select("	SELECT 												`id`,												`article`,												`title`,												`photo`,												`price`,												`price_sell`,												`type_id`,												`index_similarity`											FROM												`dat_catalog_list`											WHERE (												`count`>0											)											ORDER BY												rand(),												`dat_catalog_list`.`priority` DESC,												`dat_catalog_list`.`rating` DESC,												`dat_catalog_list`.`last_update`											LIMIT 												0, ".(isset($sell)?8:12));		for ($ri=0; $ri<$prods->num_rows; $ri++) {			$prods->cell[$ri]['group_alias'] = $assoc[$prods->cell[$ri]['type_id']];						if (empty($prods->cell[$ri]['photo']))				$prods->cell[$ri]['photo'] = 'nophoto.gif';							if (!preg_match('#^http:#', $prods->cell[$ri]['photo'])) {				$prods->cell[$ri]['photo'] = preg_replace('#;.*#','',$prods->cell[$ri]['photo']);				$prods->cell[$ri]['photo'] = "http://{$_SERVER['SERVER_NAME']}/img-dbimage/catalog/{$assoc[$prods->cell[$ri]['type_id']]}/".preg_replace('#\.([a-z]{3}$)#i','-$1',$prods->cell[$ri]['photo'])."-181с121-85.jpg";			}			$prods->cell[$ri]['psize'] = func::imageGetSizeRestric($prods->cell[$ri]['photo'], 181, 121);			$prods->cell[$ri]['title_eng'] = preg_replace('/(\(.+\))/i','',$prods->cell[$ri]['title']);		}*/				$this->content['subclass'] = "";		$this->content['content'] = array('title' => $title,								 		  'text' => !empty($text)?$text:false/*,										  'catalog' => $prods->cell*/);		return $this->content;	}}?>