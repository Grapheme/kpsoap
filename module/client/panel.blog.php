<?class panel_blog extends TPanelController {	public function blog() {		$posts = $this->core->sql->query("	SELECT												`dat_blog_list`.`alias`,												`dat_blog_group`.`title` as `group_title`,												`dat_blog_group`.`alias` as `group_alias`,												`dat_blog_list`.`title`,												`dat_blog_list`.`text`,												`dat_blog_list`.`tags`,												`dat_blog_list`.`livejournal`,												`datetime`											FROM												`dat_blog_list`,`dat_blog_group`											WHERE (												`dat_blog_group`.`id` = `dat_blog_list`.`group_id`											)											ORDER BY												`dat_blog_list`.`datetime` DESC											LIMIT 0,3");		$post_list = array();		for ($i=0; $i<$posts->num_rows; $i++) {			$imgs = func::getImagesURL($posts->cell[$i]['text']);			if ($imgs) {				$imgs_list = array();				$img_num = 0;				$transform = preg_match('#^/data/#i',$imgs[$img_num][1]);				array_push($imgs_list, array("src" => ($transform)?preg_replace('#/data/#i', '', $imgs[$img_num][1]):$imgs[$img_num][1],											 "size" =>  func::imageGetSizeRestric($imgs[$img_num][1], 310, 'auto'),											 "alt" => $imgs[$img_num][2],											 "transform" => (bool)$transform));			}			$imgs_list = false;						$text = (($stag = func::getShortTagText($posts->cell[$i]['text'])) == false)?func::subText($posts->cell[$i]['text'],300):$stag;			array_push($post_list, array("group_title" => isset($posts->cell[$i]['group_title'])?$posts->cell[$i]['group_title']:null,										 "title" => $posts->cell[$i]['title'],										 "text" => $text,										 "tags" => func::extractTags($posts->cell[$i]['tags']),										 "livejournal" => $posts->cell[$i]['livejournal'],										 "imgs_list" => $imgs_list,										 "datetime" => preg_replace('#([0-9]{4})-([0-9]{2})-([0-9]{2}) ([0-9]{2}):([0-9]{2}):([0-9]{2})#', '$3.$2.$1', $posts->cell[$i]['datetime']),										 "href" => "/{$this->site_section_alias}/{$posts->cell[$i]['group_alias']}/{$posts->cell[$i]['alias']}/",										 "module_href" => "/{$this->site_section_alias}/"));		}		return $post_list;	}}?>